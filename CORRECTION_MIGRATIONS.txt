â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”§ CORRECTION DES ERREURS DE MIGRATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PROBLÃˆMES IDENTIFIÃ‰S
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. âŒ Erreur enfant_parent:
   "Can't create table... Foreign key constraint is incorrectly formed"
   
   Cause: La migration rÃ©fÃ©rence 'parents' mais la table s'appelle 'parent_models'
   
   âœ… CORRIGÃ‰: database/migrations/2025_06_15_185011_create_enfant_parent_table.php
   ChangÃ©: constrained() â†’ constrained('parent_models')

2. âŒ Erreur tickets:
   "Duplicata du champ '' pour la clef 'tickets_ticket_number_unique'"
   
   Cause: Des tickets avec ticket_number vide existent dÃ©jÃ 
   
   âœ… SOLUTION: RÃ©initialiser la base de donnÃ©es


ğŸ”„ SOLUTION RAPIDE (DÃ©veloppement)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Option 1: Script automatique
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
php fix-migrations.php

Option 2: Commandes manuelles
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
php artisan db:wipe
php artisan migrate


ğŸ”„ SOLUTION POUR PRODUCTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âš ï¸  NE PAS utiliser db:wipe ou migrate:fresh en production!

Ã€ la place:

1. Corriger la migration enfant_parent (dÃ©jÃ  fait)

2. Pour les tickets, crÃ©er une nouvelle migration:

php artisan make:migration fix_tickets_table_constraints

Contenu:
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    public function up(): void
    {
        // Supprimer les tickets avec ticket_number vide
        DB::table('tickets')->whereNull('ticket_number')->delete();
        DB::table('tickets')->where('ticket_number', '')->delete();
        
        // Ajouter la contrainte unique si elle n'existe pas
        if (!Schema::hasColumn('tickets', 'ticket_number')) {
            Schema::table('tickets', function (Blueprint $table) {
                $table->string('ticket_number')->unique();
            });
        }
    }

    public function down(): void
    {
        // Rien Ã  faire
    }
};

3. Lancer la migration:
php artisan migrate


ğŸ“Š VÃ‰RIFICATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

AprÃ¨s correction, vÃ©rifier:

php artisan migrate:status

Toutes les migrations doivent Ãªtre "Ran" âœ…


ğŸ§ª TEST
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. DÃ©marrer le serveur:
   php artisan serve --port=8000

2. Tester les 2 modes de paiement:
   php test-2-modes-simples.php

3. VÃ©rifier que tout fonctionne:
   âœ… Mode "online" crÃ©e un ticket
   âœ… Mode "cash" crÃ©e un ticket avec QR code


ğŸ“ FICHIERS MODIFIÃ‰S
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… database/migrations/2025_06_15_185011_create_enfant_parent_table.php
   Ligne 15: constrained('enfants')
   Ligne 16: constrained('parent_models')


ğŸ’¡ CONSEIL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

En dÃ©veloppement:
â€¢ Utiliser migrate:fresh pour tout rÃ©initialiser
â€¢ Pas de problÃ¨me de perdre les donnÃ©es

En production:
â€¢ JAMAIS utiliser migrate:fresh ou db:wipe
â€¢ CrÃ©er des migrations de correction
â€¢ Sauvegarder la base avant toute modification


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
